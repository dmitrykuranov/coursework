#include "stdafx.h"
#include <iostream>
#include <stdio.h>
#include <cstdio>
#include <string>
#include <fstream>

using namespace std;

int searchIN()
{
	string string;
	ifstream file("OUTlab1part2IN.txt");
	int m = 0;
	while (getline(file, string))
	{
		for (int i = 0; i < string.length(); i++)
		{
			if (string[i] == '{')
				m = m + 1;
		}
	}
	file.close();
	return (m);
}

int search(string string, int f)
{
	int fl = f;
	for (int i = 0; i < string.length(); i++)
	{
		if (string[i] == '{')
			fl = fl + 1;
		if (string[i] == '}')
			fl = fl - 1;
	}
	return(fl);
}

int main()
{
	string string, str;
	ifstream file("INlab1part2.txt");
	ofstream fout("OUTlab1part2IN.txt");
	int k = 0;
	int m = 0;
	while (getline(file, string))
	{
		k = search(string, k);
		if (k > 0)
		{
			if (m > 0)
			{
				fout << string;
				fout << "\n";
			}
			m++;
		}
	}
	file.close();
	fout.close();
	m = searchIN();
	int num = 3;
	ifstream files("OUTlab1part2IN.txt");
	ofstream fouts("OUTlab1part2.txt");
	int fl = 0;
	int ml = 0;
	for (int i = m; i>0; i--)
		while (getline(files, string))
		{
			fl = search(string, fl);
			if (fl > 0)
			{
				if (ml > 0)
				{
					fouts << string;
					fouts << "\n";
				}
				ml++;
			}
		}
	files.close();
	fouts.close();
}
